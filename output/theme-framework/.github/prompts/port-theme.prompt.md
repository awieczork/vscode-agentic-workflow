---
description: 'Port a VS Code color theme to RStudio (.rstheme) and DBeaver (XML) formats with semantic color consistency'
agent: 'build'
argument-hint: 'Provide the path to the VS Code *-color-theme.json file to port'
---

<!-- Provide the path to a VS Code color theme JSON file. The prompt generates equivalent RStudio and DBeaver theme files. -->

Port a VS Code theme to RStudio and DBeaver formats, preserving semantic color consistency across all three editors.


<source_input>

The source theme file: `${file}`

Parse the VS Code `*-color-theme.json` and extract every color value from these sections:

- `colors` — editor chrome (background, foreground, gutter, selection, active line, cursor)
- `tokenColors` — TextMate scopes (comment, keyword, string, function, constant, type, variable, operator, punctuation)
- `semanticTokenColors` — LSP-based overrides that take precedence over `tokenColors` when present

Build a palette map keyed by semantic role before generating any output. This map is the single source of truth for both target formats.

</source_input>


<semantic_mapping>

Cross-editor token mapping defines how VS Code roles translate to RStudio and DBeaver targets. Every mapping must be honored exactly — do not approximate when a direct equivalent exists.

**Editor chrome:**

| Semantic role | VS Code key | RStudio selector | DBeaver preference key |
|---|---|---|---|
| Background | `editor.background` | `.ace_editor { background }` | `org.jkiss.dbeaver.sql.editor.color.text.background` |
| Foreground | `editor.foreground` | `.ace_editor { color }` | `org.jkiss.dbeaver.sql.editor.color.text.foreground` |
| Gutter background | `editorGutter.background` | `.ace_gutter { background }` | N/A |
| Gutter foreground | `editorLineNumber.foreground` | `.ace_gutter { color }` | N/A |
| Cursor | `editorCursor.foreground` | `.ace_cursor { color }` | N/A |
| Selection | `editor.selectionBackground` | `.ace_marker-layer .ace_selection { background }` | `org.jkiss.dbeaver.sql.editor.color.text.selection.background` |
| Active line | `editor.lineHighlightBackground` | `.ace_marker-layer .ace_active-line { background }` | `org.jkiss.dbeaver.sql.editor.color.current.line.background` |

**Syntax tokens:**

| Semantic role | VS Code scope | RStudio selector | DBeaver preference key |
|---|---|---|---|
| Comment | `comment` | `.ace_comment` | `org.jkiss.dbeaver.sql.editor.color.comment.foreground` |
| Keyword | `keyword` | `.ace_keyword` | `org.jkiss.dbeaver.sql.editor.color.keyword.foreground` |
| String | `string` | `.ace_string` | `org.jkiss.dbeaver.sql.editor.color.string.foreground` |
| Function | `entity.name.function` | `.ace_support.ace_function` | `org.jkiss.dbeaver.sql.editor.color.function.foreground` |
| Number/constant | `constant` | `.ace_constant` | `org.jkiss.dbeaver.sql.editor.color.number.foreground` |
| Type | `entity.name.type` | N/A | `org.jkiss.dbeaver.sql.editor.color.datatype.foreground` |
| Variable | `variable` | `.ace_identifier` | N/A |
| Operator | `keyword.operator` | `.ace_keyword.ace_operator` | `org.jkiss.dbeaver.sql.editor.color.delimiter.foreground` |

</semantic_mapping>


<generate_rstheme>

Generate a complete `.rstheme` CSS file. RStudio themes are standard CSS applied to the Ace editor instance.

**Required structure:**

```css
/* Theme: [name] — ported from VS Code */
/* Generated by theme-framework */

.ace_editor {
  background-color: [editor.background];
  color: [editor.foreground];
  font-family: "Fira Code", "Cascadia Code", monospace;
}

.ace_gutter {
  background: [editorGutter.background];
  color: [editorLineNumber.foreground];
}

.ace_cursor {
  color: [editorCursor.foreground];
}

.ace_marker-layer .ace_selection {
  background: [editor.selectionBackground];
}

.ace_marker-layer .ace_active-line {
  background: [editor.lineHighlightBackground];
}
```

**Syntax classes** — generate `.ace_comment`, `.ace_keyword`, `.ace_string`, `.ace_support.ace_function`, `.ace_constant`, `.ace_constant.ace_numeric`, `.ace_identifier`, `.ace_keyword.ace_operator`, `.ace_paren`, and `.ace_invisible` entries. Apply `color` and `font-style` (italic for comments if the VS Code theme uses `fontStyle: italic`).

**Additional RStudio classes** — include `.ace_marker-layer .ace_bracket` (bracket matching), `.ace_indent-guide` (indent guides), and `.ace_print-margin` (print margin line) using semantically appropriate colors from the palette.

Reference [theme-conventions.instructions.md](../instructions/theme-conventions.instructions.md) for format specifications and naming rules.

</generate_rstheme>


<generate_dbeaver>

Generate DBeaver theme preference entries. DBeaver uses Eclipse preference keys — approximately 20 SQL editor color keys versus VS Code's 800+ scopes.

**Preference key format:**

Each color entry is a key-value pair in Eclipse preference syntax:

```
org.jkiss.dbeaver.sql.editor.color.[token].foreground=[R],[G],[B]
org.jkiss.dbeaver.sql.editor.color.[token].background=[R],[G],[B]
```

Colors use comma-separated decimal RGB (not hex). Convert all VS Code hex values to `R,G,B` format.

**Required preference keys:**

- `color.text.foreground` / `color.text.background`
- `color.text.selection.background`
- `color.current.line.background`
- `color.keyword.foreground`
- `color.string.foreground`
- `color.number.foreground`
- `color.comment.foreground`
- `color.datatype.foreground`
- `color.function.foreground`
- `color.delimiter.foreground`

**DBeaver-unique tokens** — these SQL-specific tokens have no VS Code equivalent. Derive each from the nearest semantic palette step:

| DBeaver token | Derive from | Rationale |
|---|---|---|
| `color.table.foreground` | `entity.name.type` color | Tables are named types in SQL context |
| `color.column.foreground` | `variable` color | Columns are field-level identifiers |
| `color.schema.foreground` | `entity.name.namespace` or foreground at 70% opacity | Schemas are namespace qualifiers |
| `color.composite.foreground` | `entity.name.type` color shifted 15° on hue wheel | Composite types are type-adjacent but distinct |
| `color.ai.suggestion.foreground` | Foreground at 40% opacity blended with background | Ghost text — low contrast by design |

**Eclipse E4 CSS overrides** — for full dark mode support, generate a CSS snippet targeting the DBeaver SQL editor part:

```css
/* DBeaver E4 dark mode overrides */
.MPart.Editor {
  background-color: [editor.background];
  color: [editor.foreground];
}
```

**Constraint**: DBeaver has no user-facing theme import — the output must be packaged as a plugin or applied via workspace preferences. Note this in a comment header.

Reference [theme-conventions.instructions.md](../instructions/theme-conventions.instructions.md) for format specifications.

</generate_dbeaver>


<contrast_audit>

After generating both output files, run a contrast audit to verify the ported themes maintain the same accessibility characteristics as the source VS Code theme.

Invoke the contrast-audit skill: [SKILL.md](../skills/contrast-audit/SKILL.md)

**Audit requirements:**

- Verify WCAG 2.1 AA contrast ratios (4.5:1 for normal text, 3:1 for large text) against the editor background for every foreground color in both outputs
- Compare each ported color against the source VS Code value — flag any drift exceeding deltaE 2000 > 3.0
- Validate the DBeaver-unique derived colors maintain minimum 4.5:1 contrast against `color.text.background`
- Report pass/fail per token with measured ratio

If any token fails contrast, suggest an adjusted color that preserves hue but meets the minimum ratio.

</contrast_audit>


<output_requirements>

Produce three files:

1. **`[name].rstheme`** — complete RStudio CSS theme file, ready for import via RStudio Appearance settings
2. **`[name]-dbeaver.epf`** — Eclipse preference file with all DBeaver color keys, including header comment noting plugin packaging requirement
3. **`[name]-audit.md`** — contrast audit report with per-token pass/fail results for both target formats

Where `[name]` is derived from the source VS Code theme filename (strip `-color-theme.json` suffix, kebab-case).

All three files go in the same directory as the source theme JSON.

</output_requirements>
